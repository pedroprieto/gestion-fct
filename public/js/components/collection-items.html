<link rel='ractive' href='./collection-edit-template.html' name='cjedit'>

<div id="items">
  <ul class="list-group">
    {{#collection.items}}
      <li class="list-group-item">
	
	<div class="item-actions">
	  <button type="button" class="item-href btn button-default btn-xs" rel="{{ rel }}" href="{{ href }}" on-click="followLink">Ver</button>
	  {{#if collection.template}}
	    <button type="button" class="item-edit btn button-default btn-xs" rel="edit" on-click="showEditForm" disabled="{{showedit}}" >Editar</button>
	  {{/if}}
	  <button type="button" class="item-delete btn button-default btn-xs" on-click="httpDelete">Borrar</button>
	</div>

	<div class="item-data">
	  {{#data}}
	    <p><u>{{prompt}}</u> <br> {{value}}</p>
	  {{/data}}
	</div>

	<div class="item-links btn-group ">
	  {{#links}}
	    <button type="button" class="btn btn-primary" rel="{{ rel }}" on-click="followLink"> {{prompt}}</button>
	  {{/links}}
	</div>

	{{#if showedit }}<cjedit item_href="{{href}}" template="{{editTemplate}}" showedit="{{showedit}}" collection="{{collection}}"></cjedit>{{/if}}

      </li>
    {{/collection.items}}
  </ul>

</div>

<style>
.item-data {
	display: flex;
	flex-flow: row wrap;
	
}

.item-data p {
	flex: 1 auto;
	margin: 5px;
}
</style>

<script>
component.exports = {
  oninit: function() {

    function cjData(item,name) {
      var coll, rtn;
      
      rtn = null;
      coll = item.data;
      for(var k in coll) {
	var data = coll[k];
	if(data.name === name) {
	  rtn = data;
	  break;
	}
      }
      return rtn;
    };

    this.on( 'showEditForm', function (event) {
      // Creamos item.showedit
      var showedit = true;
      var it = event.context;
      it.showedit = true;

      // Creamos item.editTemplate
      var template = this.get('collection.template');
      var item_data = event.context.data;
      var filled_template = {};
      filled_template.data = [];

      for(var k in template.data) {
	i = template.data[k];
	i_d = cjData(event.context, i.name);
	var t_item = {};
	t_item.name = i.name;
	t_item.value = i_d.value || "";
	t_item.prompt = i.prompt;
	t_item.required = i.required;
	t_item.match = i.match;
	filled_template.data.push(t_item);
      }

      it.editTemplate = filled_template;

      // Actualizamos objeto item
      this.set(event.keypath, it);


      
      return false;
    });

  }
};


</script>



